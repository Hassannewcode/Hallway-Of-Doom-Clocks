<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hall of Clocks - The Timezone Journey</title>
  <meta name="description" content="An immersive hall of clocks showing every timezone worldwide, with scroll-driven storytelling, live synced digital clocks, and rich micro-interactions." />
  <link rel="icon" href="favicon.ico" />
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  
  <!-- GSAP & ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>
  
  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js" defer></script>
  
  <!-- Locomotive Scroll -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js" defer></script>

  <!-- Lottie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" defer></script>

  <style>
    /* Reset + base */
    html, body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #e0e7f1;
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      height: 100%;
      scroll-behavior: smooth;
    }
    /* Loader */
    .loader {
      position: fixed;
      inset: 0;
      background: #111a28;
      color: #89aaff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.4rem;
      z-index: 9999;
      user-select: none;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      font-family: monospace;
    }
    /* Custom cursor */
    .custom-cursor {
      position: fixed;
      top: 0; left: 0;
      width: 20px; height: 20px;
      background: #89aaff;
      border-radius: 50%;
      pointer-events: none;
      mix-blend-mode: difference;
      transition: transform 0.15s ease, background-color 0.3s ease;
      z-index: 9999;
      transform-origin: center;
      will-change: transform, left, top, background-color;
      box-shadow: 0 0 6px #89aaffaa;
    }
    /* Cursor hover effect */
    a:hover ~ .custom-cursor,
    button:hover ~ .custom-cursor,
    input:hover ~ .custom-cursor {
      background: #ffcc77;
      box-shadow: 0 0 10px #ffcc77bb;
      transform: scale(2);
    }
    /* Search bar */
    .search-bar {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      width: 350px;
      max-width: 90vw;
      z-index: 1000;
    }
    .search-bar input {
      width: 100%;
      padding: 0.75rem 1.2rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      background: #162a44;
      color: #cdd6f4;
      border: 2px solid #3b6aa0;
      box-shadow: 0 0 8px rgba(77, 122, 194, 0.5);
      font-weight: 600;
      letter-spacing: 0.05em;
      transition: all 0.3s ease;
      user-select: text;
    }
    .search-bar input::placeholder {
      color: #7a8ba8;
    }
    .search-bar input:focus {
      border-color: #ffcc77;
      box-shadow: 0 0 12px #ffcc77bb;
      background: #1b3762;
      color: #fff;
    }
    /* Navigation */
    nav {
      position: fixed;
      top: 1rem;
      right: 1.5rem;
      z-index: 1000;
    }
    nav button {
      background: transparent;
      border: 2px solid #89aaff;
      border-radius: 8px;
      color: #89aaff;
      padding: 0.5rem 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: monospace;
      letter-spacing: 0.1em;
      user-select: none;
    }
    nav button:hover,
    nav button:focus {
      background: #89aaff;
      color: #111;
      outline: none;
      box-shadow: 0 0 10px #89aaffaa;
    }
    /* Headline */
    .headline {
      font-weight: 900;
      font-size: clamp(3rem, 6vw, 6rem);
      text-align: center;
      margin: 7rem 1rem 2rem;
      user-select: none;
      line-height: 1.1;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      filter: drop-shadow(0 0 4px #89aaffaa);
    }
    /* Subheading / Story text */
    .story-text {
      max-width: 720px;
      margin: 0 auto 4rem;
      font-weight: 400;
      font-size: 1.15rem;
      line-height: 1.5;
      color: #a6b0d9cc;
      text-align: center;
      padding: 0 1rem;
      user-select: none;
      letter-spacing: 0.03em;
    }
    /* Clocks container - asymmetric grid */
    .clocks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 2rem;
      padding: 2rem 2rem 8rem;
      max-width: 1600px;
      margin: 0 auto 6rem;
      user-select: none;
      /* Asymmetric shape - create slight shift with nth-child */
    }
    /* Clock card */
    .clock-card {
      background: rgba(22, 42, 66, 0.85);
      border: 1px solid #284b7d;
      border-radius: 14px;
      padding: 1.6rem 1.8rem;
      text-align: center;
      backdrop-filter: blur(8px);
      box-shadow: 0 0 14px rgba(136, 173, 255, 0.15);
      cursor: default;
      transition:
        transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      will-change: transform, box-shadow;
      user-select: none;
    }
    /* Hover effect on clock */
    .clock-card:hover,
    .clock-card:focus-within {
      transform: translateY(-10px) scale(1.05);
      box-shadow: 0 0 20px #ffcc77;
      border-color: #ffcc77;
      outline: none;
    }
    /* Country/timezone name */
    .clock-country {
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 0.45rem;
      text-transform: capitalize;
      color: #ffd382;
      user-select: text;
    }
    /* Digital time */
    .clock-time {
      font-size: 2.4rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      color: #fefefe;
      user-select: text;
      font-variant-numeric: tabular-nums;
      font-family: 'Courier New', Courier, monospace;
      filter: drop-shadow(0 0 3px #ffcc77aa);
    }
    /* Section padding for storytelling segments */
    section {
      position: relative;
      max-width: 1200px;
      margin: 0 auto 6rem;
      padding: 2rem 1rem;
    }
    /* Sticky CTA at bottom */
    .sticky-cta {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: #ffcc77;
      color: #111;
      font-weight: 700;
      padding: 1rem 2rem;
      border-radius: 12px;
      box-shadow: 0 0 18px #ffcc77cc;
      cursor: pointer;
      user-select: none;
      z-index: 1000;
      font-family: monospace;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
    }
    .sticky-cta:hover,
    .sticky-cta:focus {
      background: #ffd98b;
      box-shadow: 0 0 24px #ffd98bcc;
      outline: none;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      .headline {
        font-size: 2.6rem;
      }
      .search-bar {
        width: 90vw;
      }
      .clock-time {
        font-size: 1.8rem;
      }
      .clock-country {
        font-size: 1rem;
      }
      .sticky-cta {
        bottom: 1rem;
        right: 1rem;
        padding: 0.75rem 1.5rem;
        font-size: 0.9rem;
      }
    }
    /* Three.js canvas background */
    canvas#bg {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      user-select: none;
    }
    /* Animated favicon style */
    link[rel="icon"] {
      transition: transform 0.3s ease;
    }
  </style>
</head>
<body>
  <!-- Loader -->
  <div class="loader" role="alert" aria-live="assertive" aria-busy="true">Loading Clocks...</div>

  <!-- Custom cursor -->
  <div class="custom-cursor" aria-hidden="true"></div>

  <!-- Three.js background canvas -->
  <canvas id="bg" aria-hidden="true"></canvas>

  <!-- Search bar -->
  <div class="search-bar" role="search">
    <input
      id="search"
      type="search"
      placeholder="Search country or city..."
      autocomplete="off"
      spellcheck="false"
      aria-label="Search timezones by country or city"
      aria-describedby="search-desc"
    />
    <div id="search-desc" class="visually-hidden">Type to filter clocks by country or city name</div>
  </div>

  <!-- Navigation -->
  <nav>
    <button id="sound-toggle" aria-pressed="false" aria-label="Toggle ambient sound">ðŸ”ˆ Sound Off</button>
  </nav>

  <!-- Main content -->
  <main id="main-content" data-scroll-container>
    <section aria-labelledby="intro-title">
      <h1 class="headline" id="intro-title">Hall of Clocks: The Timezone Journey</h1>
      <p class="story-text" tabindex="0">
        Explore every timezone in the world in real-time. Scroll through this immersive hall where each clock tells a story of its own city or country.
        Use the search box above to find your timezone instantly. Feel the pulse of time, synced perfectly with your system clock.
      </p>
    </section>
    <section aria-labelledby="clocks-title">
      <h2 id="clocks-title" class="story-text" style="text-align:center; font-weight:700; font-size:1.8rem; color:#ffd382; margin-bottom:2rem;">
        The Clocks
      </h2>
      <div class="clocks-grid" id="clocks" role="list" aria-live="polite" aria-relevant="additions removals"></div>
    </section>
  </main>

  <!-- Sticky CTA -->
  <button class="sticky-cta" id="top-button" aria-label="Scroll to top">â†‘ Back to Top</button>

  <!-- Cookie Consent -->
  <div id="cookie-consent" role="alertdialog" aria-modal="true" aria-live="polite" aria-labelledby="cookie-title" aria-describedby="cookie-desc" style="display:none; position: fixed; bottom: 1rem; left: 50%; transform: translateX(-50%); background:#162a44; color:#cdd6f4; padding:1rem 2rem; border-radius:10px; box-shadow: 0 0 20px #89aaffaa; z-index:10000; max-width: 90vw; font-size: 0.9rem; user-select:none;">
    <h3 id="cookie-title" style="margin:0 0 0.5rem 0; font-weight:700;">Cookie Consent</h3>
    <p id="cookie-desc" style="margin:0 0 1rem 0;">This site uses cookies for analytics and to improve your experience. By continuing, you agree to our <a href="#" style="color:#ffcc77;" target="_blank" rel="noopener noreferrer">Privacy Policy</a>.</p>
    <button id="cookie-accept" style="background:#ffcc77; border:none; padding:0.5rem 1rem; border-radius:8px; font-weight:700; cursor:pointer; user-select:none;">Accept</button>
  </div>

  <div class="visually-hidden" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;"> <!-- for screen reader text --> </div>

  <script>
    // Wait for DOMContentLoaded for smooth experience
    window.addEventListener('DOMContentLoaded', () => {
      // Loader fade out
      gsap.to(".loader", {
        y: "-100%",
        delay: 1,
        duration: 1,
        ease: "power4.inOut",
        onComplete: () => document.querySelector(".loader").style.display = 'none'
      });

      // GSAP headline animation
      gsap.from(".headline", {
        y: 50,
        opacity: 0,
        delay: 2,
        duration: 1.2,
        ease: "power4.out"
      });

      // Initialize Locomotive Scroll
      const scroll = new LocomotiveScroll({
        el: document.querySelector("[data-scroll-container]"),
        smooth: true,
        multiplier: 1,
        reloadOnContextChange: true
      });

      // Custom cursor
      const cursor = document.querySelector(".custom-cursor");
      window.addEventListener("mousemove", e => {
        cursor.style.left = e.clientX + "px";
        cursor.style.top = e.clientY + "px";
      });
      document.querySelectorAll("a, button, input").forEach(el => {
        el.addEventListener("mouseenter", () => {
          cursor.style.transform = "scale(2)";
          cursor.style.backgroundColor = "#ffcc77";
          cursor.style.boxShadow = "0 0 15px #ffcc77cc";
        });
        el.addEventListener("mouseleave", () => {
          cursor.style.transform = "scale(1)";
          cursor.style.backgroundColor = "#89aaff";
          cursor.style.boxShadow = "0 0 6px #89aaffaa";
        });
      });

      // Animated favicon
      const favicon = document.querySelector('link[rel="icon"]');
      let faviconFrames = [
        "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><circle fill='%23ffcc77' cx='8' cy='8' r='7'/></svg>",
        "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><circle fill='%23ffe0a1' cx='8' cy='8' r='7'/></svg>",
        "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><circle fill='%23ffcc77' cx='8' cy='8' r='7'/></svg>"
      ];
      let favIndex = 0;
      setInterval(() => {
        favicon.href = faviconFrames[favIndex];
        favIndex = (favIndex + 1) % faviconFrames.length;
      }, 1200);

      // Sound toggle logic
      let soundEnabled = false;
      const soundBtn = document.getElementById('sound-toggle');
      // Simple ambient sound loop (optional)
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      let oscillator;
      function startSound() {
        if (!oscillator) {
          oscillator = audioContext.createOscillator();
          oscillator.type = "sine";
          oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
          oscillator.connect(audioContext.destination);
          oscillator.start();
        }
      }
      function stopSound() {
        if (oscillator) {
          oscillator.stop();
          oscillator.disconnect();
          oscillator = null;
        }
      }
      soundBtn.addEventListener('click', () => {
        if (soundEnabled) {
          stopSound();
          soundBtn.textContent = "ðŸ”ˆ Sound Off";
          soundBtn.setAttribute('aria-pressed', 'false');
        } else {
          if (audioContext.state === 'suspended') {
            audioContext.resume();
          }
          startSound();
          soundBtn.textContent = "ðŸ”Š Sound On";
          soundBtn.setAttribute('aria-pressed', 'true');
        }
        soundEnabled = !soundEnabled;
      });

      // Scroll to top button logic
      const topBtn = document.getElementById("top-button");
      topBtn.addEventListener("click", () => {
        scroll.scrollTo(0);
        document.getElementById("search").focus();
      });

      // Cookie consent
      const cookieConsent = document.getElementById('cookie-consent');
      const cookieAcceptBtn = document.getElementById('cookie-accept');
      const cookieAccepted = localStorage.getItem('cookieAccepted');
      if (!cookieAccepted) {
        cookieConsent.style.display = 'block';
      }
      cookieAcceptBtn.addEventListener('click', () => {
        localStorage.setItem('cookieAccepted', 'true');
        cookieConsent.style.display = 'none';
      });

      // Timezone data from IANA
      // We'll use a curated list of main timezones with country/city names and UTC offsets
      // Source: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
      const timezones = [
        {zone: "Pacific/Midway", country:"United States", city:"Midway Atoll"},
        {zone: "Pacific/Honolulu", country:"United States", city:"Honolulu"},
        {zone: "America/Anchorage", country:"United States", city:"Anchorage"},
        {zone: "America/Los_Angeles", country:"United States", city:"Los Angeles"},
        {zone: "America/Denver", country:"United States", city:"Denver"},
        {zone: "America/Chicago", country:"United States", city:"Chicago"},
        {zone: "America/New_York", country:"United States", city:"New York"},
        {zone: "America/Caracas", country:"Venezuela", city:"Caracas"},
        {zone: "America/Sao_Paulo", country:"Brazil", city:"SÃ£o Paulo"},
        {zone: "Atlantic/Azores", country:"Portugal", city:"Azores"},
        {zone: "Europe/London", country:"United Kingdom", city:"London"},
        {zone: "Europe/Paris", country:"France", city:"Paris"},
        {zone: "Europe/Berlin", country:"Germany", city:"Berlin"},
        {zone: "Europe/Moscow", country:"Russia", city:"Moscow"},
        {zone: "Asia/Dubai", country:"United Arab Emirates", city:"Dubai"},
        {zone: "Asia/Kolkata", country:"India", city:"Kolkata"},
        {zone: "Asia/Singapore", country:"Singapore", city:"Singapore"},
        {zone: "Asia/Tokyo", country:"Japan", city:"Tokyo"},
        {zone: "Australia/Sydney", country:"Australia", city:"Sydney"},
        {zone: "Pacific/Auckland", country:"New Zealand", city:"Auckland"},
        {zone: "Pacific/Fiji", country:"Fiji", city:"Fiji"},
        {zone: "Pacific/Tongatapu", country:"Tonga", city:"Tongatapu"},
      ];

      // Create clock cards in grid
      const clocksGrid = document.getElementById('clocks');
      function pad(n) {
        return n < 10 ? '0'+n : n;
      }

      function createClockCard(tz) {
        const card = document.createElement('article');
        card.classList.add('clock-card');
        card.setAttribute('role', 'listitem');
        card.tabIndex = 0;

        // Country/City label
        const label = document.createElement('div');
        label.className = 'clock-country';
        label.textContent = `${tz.city}, ${tz.country}`;
        card.appendChild(label);

        // Digital time display
        const timeDisplay = document.createElement('div');
        timeDisplay.className = 'clock-time';
        timeDisplay.setAttribute('aria-live', 'off');
        timeDisplay.setAttribute('aria-atomic', 'true');
        timeDisplay.textContent = '00:00:00';
        card.appendChild(timeDisplay);

        // Attach timezone data
        card.dataset.zone = tz.zone;
        card.dataset.city = tz.city.toLowerCase();
        card.dataset.country = tz.country.toLowerCase();

        // Update time every second
        function updateTime() {
          const now = new Date();
          try {
            const options = {
              timeZone: tz.zone,
              hour12: false,
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit',
            };
            const formatter = new Intl.DateTimeFormat([], options);
            timeDisplay.textContent = formatter.format(now);
          } catch(e) {
            timeDisplay.textContent = 'Error';
          }
        }
        updateTime();
        setInterval(updateTime, 1000);

        return card;
      }

      // Populate clocks
      timezones.forEach(tz => {
        clocksGrid.appendChild(createClockCard(tz));
      });

      // Search filtering
      const searchInput = document.getElementById('search');
      searchInput.addEventListener('input', e => {
        const query = e.target.value.trim().toLowerCase();
        const allClocks = clocksGrid.querySelectorAll('.clock-card');
        let visibleCount = 0;
        allClocks.forEach(card => {
          const city = card.dataset.city;
          const country = card.dataset.country;
          if(city.includes(query) || country.includes(query)) {
            card.style.display = 'block';
            visibleCount++;
          } else {
            card.style.display = 'none';
          }
        });
        if (visibleCount === 0) {
          clocksGrid.innerHTML = `<p style="color:#ffcc77; text-align:center; font-weight:700; font-size:1.2rem; user-select:none;">No results for "<em>${query}</em>"</p>`;
        } else {
          // Re-add clocks if previously replaced
          if(clocksGrid.querySelector('p')) {
            clocksGrid.innerHTML = '';
            timezones.forEach(tz => {
              clocksGrid.appendChild(createClockCard(tz));
            });
            // Re-run filter to keep consistent
            searchInput.dispatchEvent(new Event('input'));
          }
        }
      });

      // Three.js starfield background
      function createStarField() {
        const canvas = document.getElementById('bg');
        const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0);

        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        // Create stars
        const starsGeometry = new THREE.BufferGeometry();
        const starCount = 1000;
        const positions = [];
        for(let i=0; i<starCount; i++) {
          positions.push((Math.random()-0.5)*200);
          positions.push((Math.random()-0.5)*200);
          positions.push((Math.random()-0.5)*200);
        }
        starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

        const starsMaterial = new THREE.PointsMaterial({ color: 0xaadfff, size: 0.4, sizeAttenuation: true, opacity: 0.8, transparent: true });
        const starField = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(starField);

        function animate() {
          requestAnimationFrame(animate);
          starField.rotation.y += 0.0006;
          starField.rotation.x += 0.0003;
          renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
          renderer.setSize(window.innerWidth, window.innerHeight);
          camera.aspect = window.innerWidth/window.innerHeight;
          camera.updateProjectionMatrix();
        });
      }
      createStarField();

      // Accessibility helper - visually hidden class
      const styleVisuallyHidden = document.createElement('style');
      styleVisuallyHidden.textContent = `
        .visually-hidden {
          position: absolute !important;
          height: 1px; width: 1px;
          overflow: hidden;
          clip: rect(1px, 1px, 1px, 1px);
          clip-path: inset(50%);
          white-space: nowrap;
          border: 0;
          padding: 0;
          margin: -1px;
        }
      `;
      document.head.appendChild(styleVisuallyHidden);

      // Easter egg: Konami code to toggle all clocks to 24h / 12h toggle
      const konamiCode = [38,38,40,40,37,39,37,39,66,65];
      let konamiIndex = 0;
      let use24h = true;
      window.addEventListener('keydown', e => {
        if (e.keyCode === konamiCode[konamiIndex]) {
          konamiIndex++;
          if (konamiIndex === konamiCode.length) {
            konamiIndex = 0;
            use24h = !use24h;
            // Update all clocks format
            clocksGrid.querySelectorAll('.clock-card').forEach(card => {
              const tz = timezones.find(tz => tz.city.toLowerCase() === card.dataset.city && tz.country.toLowerCase() === card.dataset.country);
              if (!tz) return;
              const timeDisplay = card.querySelector('.clock-time');
              if (use24h) {
                timeDisplay.dataset.format = '24h';
              } else {
                timeDisplay.dataset.format = '12h';
              }
            });
            alert(`Konami Code Activated! Time format switched to ${use24h ? '24-hour' : '12-hour'} mode.`);
          }
        } else {
          konamiIndex = 0;
        }
      });

      // Update time with 12h or 24h format toggle support
      clocksGrid.querySelectorAll('.clock-card').forEach(card => {
        const tz = timezones.find(tz => tz.city.toLowerCase() === card.dataset.city && tz.country.toLowerCase() === card.dataset.country);
        if (!tz) return;
        const timeDisplay = card.querySelector('.clock-time');
        timeDisplay.dataset.format = '24h';
        function updateTime() {
          const now = new Date();
          try {
            const options = {
              timeZone: tz.zone,
              hour12: timeDisplay.dataset.format === '12h',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit',
            };
            const formatter = new Intl.DateTimeFormat([], options);
            timeDisplay.textContent = formatter.format(now);
          } catch(e) {
            timeDisplay.textContent = 'Error';
          }
        }
        updateTime();
        setInterval(updateTime, 1000);
      });

    }); // end DOMContentLoaded
  </script>
</body>
</html>
